{% extends 'base.html' %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/profile.css">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê - –§–û–¢–û –ò –ó–ê–ì–†–£–ó–ö–ê -->
        <div class="col-md-4">
            <!-- –ë–õ–û–ö –ó–ê–ì–†–£–ó–ö–ò –ù–û–í–û–ì–û –§–û–¢–û -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üì∏ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ</h5>
                </div>
                <div class="card-body">
                    <form method="post" action="{% url 'upload_photo' %}" enctype="multipart/form-data">
                        {% csrf_token %}

                        <div class="mb-3">
                            <label for="photoInput" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ</label>
                            <input type="file" name="photo" class="form-control" id="photoInput"
                                   required accept="image/*" onchange="previewImage(this)">
                            <div class="form-text">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è JPG, PNG, GIF</div>
                        </div>

                        <div class="mb-3 text-center" id="imagePreview" style="display: none;">
                            <img id="preview" class="img-thumbnail preview-image">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                            <input type="text" name="description" class="form-control"
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: '–ù–∞ –º–æ—Ä–µ' –∏–ª–∏ '–õ—é–±–∏–º–æ–µ —Ñ–æ—Ç–æ'">
                        </div>

                        <div class="form-check mb-3">
                            <input type="checkbox" name="is_main" class="form-check-input" id="mainPhotoCheck">
                            <label class="form-check-label" for="mainPhotoCheck">
                                –°–¥–µ–ª–∞—Ç—å –≥–ª–∞–≤–Ω—ã–º —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è
                            </label>
                        </div>

                        <button type="submit" class="btn btn-success w-100">
                            <i class="bi bi-cloud-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                        </button>
                    </form>
                </div>
            </div>

            <!-- –ì–ê–õ–ï–†–ï–Ø –ú–û–ò–• –§–û–¢–û -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üñºÔ∏è –ú–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h5>
                </div>
                <div class="card-body">
                    {% if photos %}
                        <div class="row">
                            {% for photo in photos %}
                                <div class="col-12 mb-3">
                                    <div class="card photo-card">
                                        <img src="{{ photo.photo.url }}" class="card-img-top gallery-image"
                                             alt="{{ photo.description|default:'–ú–æ–µ —Ñ–æ—Ç–æ' }}">

                                        <div class="card-body">
                                            {% if photo.description %}
                                                <p class="card-text photo-description">{{ photo.description }}</p>
                                            {% endif %}

                                            <div class="photo-actions">
                                                {% if photo.is_main %}
                                                    <span class="badge badge-main">‚≠ê –ì–ª–∞–≤–Ω–æ–µ</span>
                                                {% else %}
                                                    <span class="badge badge-secondary">–û–±—ã—á–Ω–æ–µ</span>
                                                {% endif %}

                                                <div class="btn-group">
                                                    {% if not photo.is_main %}
                                                        <a href="{% url 'set_main_photo' photo.id %}"
                                                           class="btn btn-sm btn-outline-primary btn-action"
                                                           title="–°–¥–µ–ª–∞—Ç—å –≥–ª–∞–≤–Ω—ã–º">
                                                            <i class="bi bi-star"></i>
                                                        </a>
                                                    {% endif %}

                                                    <a href="{% url 'delete_photo' photo.id %}"
                                                       class="btn btn-sm btn-outline-danger btn-action"
                                                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Ñ–æ—Ç–æ?')"
                                                       title="–£–¥–∞–ª–∏—Ç—å">
                                                        <i class="bi bi-trash"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-gallery">
                            <i class="bi bi-image empty-icon"></i>
                            <p class="empty-text">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</p>
                            <small class="empty-subtext">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Ñ–æ—Ç–æ –≤—ã—à–µ</small>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê - –ò–ù–§–û–†–ú–ê–¶–ò–Ø –ü–†–û–§–ò–õ–Ø -->
        <div class="col-md-8">
            <div class="profile-header">
                <h1>üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>
                <div class="header-actions">
                    <a href="{% url 'profile_edit' %}" class="btn btn-primary">
                        <i class="bi bi-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                    <a href="{% url 'home' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-house"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                    </a>
                </div>
            </div>

            <!-- –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üìã –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>üë§ –ò–º—è:</strong> {{ user.first_name }}</p>
                            <p><strong>üë• –§–∞–º–∏–ª–∏—è:</strong> {{ user.last_name }}</p>
                            <p><strong>üìß Email:</strong> {{ user.email }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>üéÇ –í–æ–∑—Ä–∞—Å—Ç:</strong> {{ user.age }} –ª–µ—Ç</p>
                            <p><strong>üèôÔ∏è –ì–æ—Ä–æ–¥:</strong> {{ user.city }}</p>
                            <p><strong>üöª –ü–æ–ª:</strong> {{ user.get_gender_display }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">üí´ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                </div>
                <div class="card-body">
                    <p><strong>üìä –°—Ç–∞—Ç—É—Å:</strong>
                        <span class="badge badge-info">{{ user.get_status_display }}</span>
                    </p>

                    <p><strong>‚ù§Ô∏è –õ–∞–π–∫–æ–≤:</strong>
                        <span class="badge badge-likes">{{ user.likes_count }}</span>
                    </p>

                    <p><strong>üéØ –£–≤–ª–µ—á–µ–Ω–∏—è:</strong></p>
                    <div class="hobbies-container">
                        {{ user.hobbies|linebreaks|default:"<span class='text-muted'>–ù–µ —É–∫–∞–∑–∞–Ω–æ</span>" }}
                    </div>

                    <p class="mt-3"><strong>üîí –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å:</strong>
                        {% if user.is_private %}
                            <span class="badge badge-private">–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</span>
                        {% else %}
                            <span class="badge badge-public">–ü—É–±–ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</span>
                        {% endif %}
                    </p>
                </div>
            </div>

            <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ê–ö–ö–ê–£–ù–¢–ê -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞</h5>
                </div>
                <div class="card-body">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number">{{ photos.count }}</div>
                            <div class="stat-label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">{{ user.likes_count }}</div>
                            <div class="stat-label">–õ–∞–π–∫–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-date">{{ user.date_joined|date:"d.m.Y" }}</div>
                            <div class="stat-label">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function previewImage(input) {
    const preview = document.getElementById('preview');
    const previewContainer = document.getElementById('imagePreview');

    if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function(e) {
            preview.src = e.target.result;
            previewContainer.style.display = 'block';
        }

        reader.readAsDataURL(input.files[0]);
    } else {
        previewContainer.style.display = 'none';
    }
}
</script>
{% endblock %}